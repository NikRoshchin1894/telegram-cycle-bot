# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∞–Ω–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –≤—ã–±–æ—Ä –¥–∞—Ç—ã —Ü–∏–∫–ª–∞ –∑–∞–≤–∏—Å–∞–ª –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã –∏–∑ –∫–∞–ª–µ–Ω–¥–∞—Ä—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥–ª–∏ –≤—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É, –∏ –ø—Ä–æ—Ü–µ—Å—Å "–∑–∞–≤–∏—Å–∞–ª".

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback_data 'ignore'** - –∫–Ω–æ–ø–∫–∏ —Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
2. **–ù–µ–ø–æ–ª–Ω—ã–µ callback query handlers** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ callback –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏–º–µ–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ callback query** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–ª–∏ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ callback_data 'ignore'**

```javascript
case 'ignore':
  // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ —Å callback_data 'ignore'
  await bot.answerCallbackQuery(callbackQuery.id, { text: '–≠—Ç–∞ –¥–∞—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞' });
  break;
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∏ —Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ (–±—É–¥—É—â–∏–µ, —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä—ã–µ, –∏–∑ –¥—Ä—É–≥–∏—Ö –º–µ—Å—è—Ü–µ–≤) –∏–º–µ–ª–∏ `callback_data: 'ignore'`, –Ω–æ –Ω–µ –±—ã–ª–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª—É—á–∞—è.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —á—Ç–æ –¥–∞—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞.

### 2. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –º–µ—Å—è—Ü–∞–º**

```javascript
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –º–µ—Å—è—Ü–∞–º –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ
else if (data === 'prev_month' || data === 'next_month') {
  const userState = userStates.get(chatId) || {};
  let currentYear = userState.currentYear || new Date().getFullYear();
  let currentMonth = userState.currentMonth || new Date().getMonth();
  
  if (data === 'prev_month') {
    currentMonth--;
    if (currentMonth < 0) {
      currentMonth = 11;
      currentYear--;
    }
  } else {
    currentMonth++;
    if (currentMonth > 11) {
      currentMonth = 0;
      currentYear++;
    }
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  userStates.set(chatId, { 
    ...userState, 
    currentYear, 
    currentMonth 
  });
  
  await bot.answerCallbackQuery(callbackQuery.id, { text: `${datePicker.months[currentMonth]} ${currentYear}` });
  
  const newCalendar = datePicker.createCalendar(currentYear, currentMonth);
  const title = userState.isUpdate ? '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç—ã —Ü–∏–∫–ª–∞' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ü–∏–∫–ª–∞';
  const description = userState.isUpdate ? '–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏–∑ –∫–∞–ª–µ–Ω–¥–∞—Ä—è:' : '–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏–∑ –∫–∞–ª–µ–Ω–¥–∞—Ä—è:';
  const calendarMessage = datePicker.createDateSelectionMessage(title, description);
  
  try {
    await bot.editMessageText(calendarMessage, {
      chat_id: chatId,
      message_id: message.message_id,
      reply_markup: newCalendar.reply_markup
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è:', error);
    // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ
    await bot.sendMessage(chatId, calendarMessage, newCalendar);
  }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º —Ä–∞–±–æ—Ç–∞–ª–∞, –Ω–æ –º–æ–≥–ª–∞ –∑–∞–≤–∏—Å–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å fallback –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.

### 3. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç**

```javascript
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã –∏–∑ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
if (data.startsWith('select_date_')) {
  const dateStr = data.replace('select_date_', '');
  await bot.answerCallbackQuery(callbackQuery.id, { text: `–í—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞: ${datePicker.formatFullDate(datePicker.parseDate(dateStr))}` });
  await handleDateSelection(chatId, dateStr, userStates.get(chatId)?.isUpdate || false);
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –¥–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∞–ª –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –æ —Ç–æ–º, —á—Ç–æ –¥–∞—Ç–∞ –≤—ã–±—Ä–∞–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω –æ—Ç–≤–µ—Ç callback query —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç–µ.

### 4. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç**

```javascript
case 'select_today':
  await bot.answerCallbackQuery(callbackQuery.id, { text: '–í—ã–±—Ä–∞–Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞' });
  const todayDate = new Date();
  await handleDateSelection(chatId, todayDate.toISOString().split('T')[0], userStates.get(chatId)?.isUpdate || false);
  break;
  
case 'select_yesterday':
  await bot.answerCallbackQuery(callbackQuery.id, { text: '–í—ã–±—Ä–∞–Ω–∞ –≤—á–µ—Ä–∞—à–Ω—è—è –¥–∞—Ç–∞' });
  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate() - 1);
  await handleDateSelection(chatId, yesterday.toISOString().split('T')[0], userStates.get(chatId)?.isUpdate || false);
  break;
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∏ "–°–µ–≥–æ–¥–Ω—è" –∏ "–í—á–µ—Ä–∞" –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç.

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚ùå –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –≤—ã–±–æ—Ä –¥–∞—Ç—ã –∑–∞–≤–∏—Å–∞–ª
- ‚ùå –ö–Ω–æ–ø–∫–∏ —Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–ª–∏ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
- ‚ùå –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º –º–æ–≥–ª–∞ –∑–∞–≤–∏—Å–∞—Ç—å
- ‚ùå –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä –¥–∞—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–ª

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –≤—ã–±–æ—Ä –¥–∞—Ç—ã —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–ª–∞–≤–Ω–æ
- ‚úÖ –í—Å–µ –∫–Ω–æ–ø–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä –¥–∞—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å fallback

## üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ callback_data:**
- `select_date_YYYY-MM-DD` - –≤—ã–±–æ—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç—ã
- `select_today` - –≤—ã–±–æ—Ä —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã
- `select_yesterday` - –≤—ã–±–æ—Ä –≤—á–µ—Ä–∞—à–Ω–µ–π –¥–∞—Ç—ã
- `prev_month` - –ø–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –º–µ—Å—è—Ü—É
- `next_month` - –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –º–µ—Å—è—Ü—É
- `ignore` - –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞—Ç
- `select_calendar` - –ø–æ–∫–∞–∑ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
- `select_manual` - –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ä—É—á–Ω–æ–º—É –≤–≤–æ–¥—É
- `back_to_method_selection` - –≤–æ–∑–≤—Ä–∞—Ç –∫ –≤—ã–±–æ—Ä—É —Å–ø–æ—Å–æ–±–∞
- `back_to_menu` - –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

### **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–∞—Ç –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ:**
- `üìç` - —Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞
- `‚úÖ` - –≤—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞
- `üö´` - –±—É–¥—É—â–∞—è –¥–∞—Ç–∞ (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞)
- `‚è∞` - —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä–∞—è –¥–∞—Ç–∞ (–±–æ–ª–µ–µ –≥–æ–¥–∞)
- `‚ö™` - –¥–∞—Ç–∞ –∏–∑ –¥—Ä—É–≥–æ–≥–æ –º–µ—Å—è—Ü–∞
- –û–±—ã—á–Ω—ã–µ —á–∏—Å–ª–∞ - –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞

### **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- Graceful fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ timeout callback query
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### **–¢–µ—Å—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞:**
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –±–æ—Ç—É
2. –í—ã–±–µ—Ä–∏—Ç–µ "üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É"
3. –í—ã–±–µ—Ä–∏—Ç–µ "üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å"
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –¥–∞—Ç—ã
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ –º–µ—Å—è—Ü–∞–º (‚óÄÔ∏è ‚ñ∂Ô∏è)
6. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –±—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä (–°–µ–≥–æ–¥–Ω—è/–í—á–µ—Ä–∞)
7. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–∂–∞—Ç—å –Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã

### **–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "–≠—Ç–∞ –¥–∞—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞"
- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–ª–∞–≤–Ω–æ
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä –¥–∞—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –¥–ª—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–î–∞—Ç–∞:** 8 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.3.0
