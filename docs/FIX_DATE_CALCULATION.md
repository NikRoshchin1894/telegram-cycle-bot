# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ –¥–∞—Ç—ã "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ"

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–í –ø–æ–ª–µ "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ" –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞ –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–¥–æ–º.

### **–ü—Ä–∏—á–∏–Ω—ã:**
1. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö**: –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–∞—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ ISO, –Ω–æ –≤ –º–µ—Ç–æ–¥–µ `getUser` –Ω–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–ª–∞—Å—å –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ–±—ä–µ–∫—Ç Date
2. **–î–≤–æ–π–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ**: –í –∫–æ–¥–µ –ø—Ä–∏–º–µ–Ω—è–ª–æ—Å—å `new Date()` –∫ —É–∂–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω–æ–π –¥–∞—Ç–µ
3. **–ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: –ú–µ—Ç–æ–¥ `getAllUsers` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–ª –¥–∞—Ç—ã, –∞ `getUser` - –Ω–µ—Ç

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### **1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `getUser` –≤ database.js:**

#### **–ë—ã–ª–æ:**
```javascript
getUser(chatId) {
  return new Promise((resolve, reject) => {
    const sql = 'SELECT * FROM users WHERE chatId = ?';
    
    this.db.get(sql, [chatId], (err, row) => {
      if (err) {
        reject(err);
      } else {
        resolve(row);  // ‚ùå –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –¥–∞—Ç—ã
      }
    });
  });
}
```

#### **–°—Ç–∞–ª–æ:**
```javascript
getUser(chatId) {
  return new Promise((resolve, reject) => {
    const sql = 'SELECT * FROM users WHERE chatId = ?';
    
    this.db.get(sql, [chatId], (err, row) => {
      if (err) {
        reject(err);
      } else if (row) {
        // ‚úÖ –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –¥–∞—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ –≤ –æ–±—ä–µ–∫—Ç Date
        resolve({
          ...row,
          lastCycleDate: new Date(row.lastCycleDate)
        });
      } else {
        resolve(null);
      }
    });
  });
}
```

### **2. –£–±—Ä–∞–Ω—ã –ª–∏—à–Ω–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ:**

#### **–ë—ã–ª–æ:**
```javascript
‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date(user.lastCycleDate).toLocaleDateString('ru-RU')}
üìÜ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date(user.lastCycleDate).toLocaleDateString('ru-RU')}
```

#### **–°—Ç–∞–ª–æ:**
```javascript
‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${user.lastCycleDate.toLocaleDateString('ru-RU')}
üìÜ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${user.lastCycleDate.toLocaleDateString('ru-RU')}
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### **–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**

1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**
   ```javascript
   // –í –º–µ—Ç–æ–¥–µ saveUser
   lastCycleDate.toISOString()  // –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ ISO
   ```

2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):**
   ```javascript
   // –í –º–µ—Ç–æ–¥–µ getUser
   new Date(row.lastCycleDate)  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –æ–±—ä–µ–∫—Ç Date
   ```

3. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:**
   ```javascript
   // –í –∫–æ–¥–µ
   user.lastCycleDate.toLocaleDateString('ru-RU')  // –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   ```

### **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å getAllUsers:**

–ú–µ—Ç–æ–¥ `getAllUsers` —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–ª –¥–∞—Ç—ã:
```javascript
const users = rows.map(row => ({
  ...row,
  lastCycleDate: new Date(row.lastCycleDate)  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
}));
```

–¢–µ–ø–µ—Ä—å `getUser` —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ.

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞ –≤ "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ"
- ‚ùå –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –º–µ—Ç–æ–¥–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –î–≤–æ–π–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞ –≤ "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ"
- ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –≤—Å–µ–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

## üîç –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

### **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞—Ç—ã:**
```
üìä –í–∞—à —Ç–µ–∫—É—â–∏–π —Ü–∏–∫–ª:

üìÖ –î–µ–Ω—å —Ü–∏–∫–ª–∞: 15 –∏–∑ 28
üåô –§–∞–∑–∞: –û–≤—É–ª—è—Ü–∏—è
üìÜ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 07.10.2024  ‚úÖ
‚è∞ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: 09:00
```

### **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã:**
- **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: –û–±—ä–µ–∫—Ç Date –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **–ú–µ—Ç–æ–¥ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**: `toLocaleDateString('ru-RU')`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
   - ‚úÖ –î–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - ‚úÖ –ü—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –¥–∞—Ç–∞

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç—ã —Ü–∏–∫–ª–∞:**
   - ‚úÖ –ù–æ–≤–∞—è –¥–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - ‚úÖ "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ" –¥–æ–ª–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è

3. **–ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ü–∏–∫–ª–µ:**
   - ‚úÖ –î–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
   - ‚úÖ –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞—Ç

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞—Ç
SELECT chatId, lastCycleDate, createdAt, updatedAt FROM users;
```

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
```javascript
} else if (row) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç–∞ –≤–∞–ª–∏–¥–Ω–∞
  const date = new Date(row.lastCycleDate);
  if (isNaN(date.getTime())) {
    console.error('Invalid date in database:', row.lastCycleDate);
    resolve(null);
  } else {
    resolve({
      ...row,
      lastCycleDate: date
    });
  }
}
```

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```javascript
// –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
console.log('Retrieved user data:', {
  chatId: row.chatId,
  lastCycleDate: row.lastCycleDate,
  parsedDate: new Date(row.lastCycleDate)
});
```

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å** –º–µ–∂–¥—É –º–µ—Ç–æ–¥–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –æ—à–∏–±–æ–∫** —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ **–£–±—Ä–∞–Ω–æ –¥–≤–æ–π–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** –¥–∞—Ç
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** –ø–∞–º—è—Ç–∏

### **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å:**
- ‚úÖ **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –ª–æ–≥–∏–∫–∞** —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏
- ‚úÖ **–ü–æ–Ω—è—Ç–Ω—ã–π –∫–æ–¥** –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π
- ‚úÖ **–õ–µ–≥–∫–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏** –ø—Ä–æ–±–ª–µ–º —Å –¥–∞—Ç–∞–º–∏

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### **–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å –¥–∞—Ç–∞–º–∏:**

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**
   ```sql
   SELECT chatId, lastCycleDate FROM users WHERE chatId = ?;
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
   ```bash
   cat bot.log | grep -i date
   ```

3. **–û—Ç–ª–∞–¥–∏—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:**
   ```javascript
   console.log('Raw date from DB:', row.lastCycleDate);
   console.log('Parsed date:', new Date(row.lastCycleDate));
   console.log('Formatted date:', new Date(row.lastCycleDate).toLocaleDateString('ru-RU'));
   ```

### **–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**
```
2024-10-07T00:00:00.000Z  // ISO —Å—Ç—Ä–æ–∫–∞
```

### **–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:**
```
07.10.2024  // –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞
```

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–ª–µ "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ" —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –¥–∞—Ç—É –±–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö!
