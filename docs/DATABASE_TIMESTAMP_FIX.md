# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ–º –¥–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ 1 –¥–µ–Ω—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ —Ä–∞–≤–Ω–æ –æ—Ç—Å—Ç–∞–≤–∞–ª–∞ –Ω–∞ 1 –¥–µ–Ω—å, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Ç–æ–º, –∫–∞–∫ –¥–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω

### **–ü—Ä–æ–±–ª–µ–º–∞ —Å CURRENT_TIMESTAMP –≤ SQLite**

**–ë—ã–ª–æ:**
```javascript
// –í –º–µ—Ç–æ–¥–µ saveUser
const sql = `
  INSERT OR REPLACE INTO users (chatId, lastCycleDate, cycleLength, updatedAt)
  VALUES (?, ?, ?, CURRENT_TIMESTAMP)
`;

// –í –º–µ—Ç–æ–¥–µ updateUser
const sql = `
  UPDATE users 
  SET ${fields.join(', ')}, updatedAt = CURRENT_TIMESTAMP
  WHERE chatId = ?
`;
```

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- `CURRENT_TIMESTAMP` –≤ SQLite –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º—è –≤ UTC
- –ü—Ä–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ –æ–±—Ä–∞—Ç–Ω–æ –≤ Date –æ–±—ä–µ–∫—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Å–¥–≤–∏–≥—É –Ω–∞ –¥–µ–Ω—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞

### **–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:**
- –°–µ—Ä–≤–µ—Ä –≤ UTC: `CURRENT_TIMESTAMP` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `2024-10-08 15:30:00`
- –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏: `2024-10-07 18:30:00` (—Å–¥–≤–∏–≥ –Ω–∞ –¥–µ–Ω—å)
- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–∞—è –¥–∞—Ç–∞: `07.10.2024` –≤–º–µ—Å—Ç–æ `08.10.2024`

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏**

```javascript
// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ timestamp
getLocalTimestamp() {
  const now = new Date();
  return now.getFullYear() + '-' + 
    String(now.getMonth() + 1).padStart(2, '0') + '-' + 
    String(now.getDate()).padStart(2, '0') + ' ' +
    String(now.getHours()).padStart(2, '0') + ':' + 
    String(now.getMinutes()).padStart(2, '0') + ':' + 
    String(now.getSeconds()).padStart(2, '0');
}
```

### 2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ saveUser**

**–ë—ã–ª–æ:**
```javascript
saveUser(chatId, lastCycleDate, cycleLength = 28) {
  return new Promise((resolve, reject) => {
    const sql = `
      INSERT OR REPLACE INTO users (chatId, lastCycleDate, cycleLength, updatedAt)
      VALUES (?, ?, ?, CURRENT_TIMESTAMP)
    `;
    
    this.db.run(sql, [chatId, lastCycleDate.toISOString(), cycleLength], function(err) {
      // ...
    });
  });
}
```

**–°—Ç–∞–ª–æ:**
```javascript
saveUser(chatId, lastCycleDate, cycleLength = 28) {
  return new Promise((resolve, reject) => {
    const sql = `
      INSERT OR REPLACE INTO users (chatId, lastCycleDate, cycleLength, updatedAt)
      VALUES (?, ?, ?, ?)
    `;
    
    this.db.run(sql, [chatId, lastCycleDate.toISOString(), cycleLength, this.getLocalTimestamp()], function(err) {
      // ...
    });
  });
}
```

### 3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ updateUser**

**–ë—ã–ª–æ:**
```javascript
updateUser(chatId, updates) {
  return new Promise((resolve, reject) => {
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–µ–π ...
    
    const sql = `
      UPDATE users 
      SET ${fields.join(', ')}, updatedAt = CURRENT_TIMESTAMP
      WHERE chatId = ?
    `;
    
    this.db.run(sql, values, function(err) {
      // ...
    });
  });
}
```

**–°—Ç–∞–ª–æ:**
```javascript
updateUser(chatId, updates) {
  return new Promise((resolve, reject) => {
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–µ–π ...
    
    fields.push('updatedAt = ?');
    values.push(this.getLocalTimestamp());
    
    const sql = `
      UPDATE users 
      SET ${fields.join(', ')}
      WHERE chatId = ?
    `;
    
    this.db.run(sql, values, function(err) {
      // ...
    });
  });
}
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚ùå `CURRENT_TIMESTAMP` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª UTC –≤—Ä–µ–º—è
- ‚ùå –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–∑—ã–≤–∞–ª–∞ —Å–¥–≤–∏–≥ –Ω–∞ –¥–µ–Ω—å
- ‚ùå –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç—Å—Ç–∞–≤–∞–ª–∞ –Ω–∞ 1 –¥–µ–Ω—å
- ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –ù–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –º–µ–∂–¥—É —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏
- ‚úÖ –¢–æ—á–Ω–∞—è –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### **–§–æ—Ä–º–∞—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ timestamp:**

```javascript
// –§–æ—Ä–º–∞—Ç: YYYY-MM-DD HH:MM:SS
// –ü—Ä–∏–º–µ—Ä: 2024-10-08 15:30:45
const localTimestamp = now.getFullYear() + '-' + 
  String(now.getMonth() + 1).padStart(2, '0') + '-' + 
  String(now.getDate()).padStart(2, '0') + ' ' +
  String(now.getHours()).padStart(2, '0') + ':' + 
  String(now.getMinutes()).padStart(2, '0') + ':' + 
  String(now.getSeconds()).padStart(2, '0');
```

### **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤:**

| –ú–µ—Ç–æ–¥ | –§–æ—Ä–º–∞—Ç | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å | –ü—Ä–æ–±–ª–µ–º—ã | –†–µ—à–µ–Ω–∏–µ |
|-------|--------|--------------|----------|---------|
| `CURRENT_TIMESTAMP` | UTC | UTC | –°–¥–≤–∏–≥ –Ω–∞ –¥–µ–Ω—å | ‚ùå –£–¥–∞–ª–µ–Ω |
| `getLocalTimestamp()` | –õ–æ–∫–∞–ª—å–Ω—ã–π | –õ–æ–∫–∞–ª—å–Ω—ã–π | –ù–µ—Ç | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |

### **–ú–µ—Å—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

1. **–ú–µ—Ç–æ–¥ `saveUser`** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—Ç—ã
2. **–ú–µ—Ç–æ–¥ `updateUser`** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `getLocalTimestamp`** - –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ timestamp

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**

```sql
CREATE TABLE users (
  chatId INTEGER PRIMARY KEY,
  lastCycleDate TEXT NOT NULL,           -- –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ü–∏–∫–ª–∞ (ISO string)
  cycleLength INTEGER DEFAULT 28,        -- –î–ª–∏–Ω–∞ —Ü–∏–∫–ª–∞
  createdAt DATETIME DEFAULT CURRENT_TIMESTAMP,  -- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (UTC)
  updatedAt DATETIME                     -- –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è)
)
```

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è:**

- ‚úÖ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –≤—Ä–µ–º—è –≤ –±–∞–∑–µ –∏ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –Ω–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –º–µ–Ω—å—à–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### **–¢–µ—Å—Ç —Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–∞—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
1. –û–±–Ω–æ–≤–∏—Ç–µ –¥–∞—Ç—É —Ü–∏–∫–ª–∞ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—Ç—É "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ" –≤ –æ—Ç–≤–µ—Ç–µ
3. –°—Ä–∞–≤–Ω–∏—Ç–µ —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞—Ç—ã —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—é—Ç

### **–¢–µ—Å—Ç –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–∞—Ö:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ –¥—Ä—É–≥–æ–º —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ
2. –û–±–Ω–æ–≤–∏—Ç–µ –¥–∞—Ç—É —Ü–∏–∫–ª–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç —Å–¥–≤–∏–≥–∞ –Ω–∞ –¥–µ–Ω—å

### **–¢–µ—Å—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –±–æ—Ç–∞:
   - –ö–æ–º–∞–Ω–¥–∞ `/mycycle`
   - –ö–Ω–æ–ø–∫–∞ "üìä –ú–æ–π —Ü–∏–∫–ª"
   - –ö–æ–º–∞–Ω–¥–∞ `/updatecycle`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–µ–∑–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –¥–∞—Ç–∞

### **–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- ‚úÖ –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ù–µ—Ç —Å–¥–≤–∏–≥–∞ –Ω–∞ –¥–µ–Ω—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–æ –≤—Å–µ—Ö —á–∞—Å—Ç—è—Ö –±–æ—Ç–∞
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–î–∞—Ç–∞:** 8 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.8.0
