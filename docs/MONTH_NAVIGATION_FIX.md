# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –º–µ—Å—è—Ü–∞–º –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ

## ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ

### **–ü—Ä–æ–±–ª–µ–º–∞:**
- –ö–Ω–æ–ø–∫–∏ ‚óÄÔ∏è –∏ ‚ñ∂Ô∏è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ—Å—è—Ü–µ–≤ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- Callback –¥–∞–Ω–Ω—ã–µ —Å–æ–¥–µ—Ä–∂–∞–ª–∏ –≥–æ–¥ –∏ –º–µ—Å—è—Ü –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö, —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ—Å—è—Ü–µ–≤ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –Ω–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –Ω–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–∂–∏–¥–∞–ª —Å—Ç–∞—Ä—ã–µ

### **–†–µ—à–µ–Ω–∏–µ:**
- –£–ø—Ä–æ—â–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ callback –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ –∏ –≥–æ–¥–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ—Å—è—Ü–µ–≤

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### **1. –£–ø—Ä–æ—â–µ–Ω–∏–µ callback –¥–∞–Ω–Ω—ã—Ö –≤ datePicker.js:**
```javascript
// –ë—ã–ª–æ:
{ text: '‚óÄÔ∏è', callback_data: `prev_month_${year}_${month}` }
{ text: '‚ñ∂Ô∏è', callback_data: `next_month_${year}_${month}` }

// –°—Ç–∞–ª–æ:
{ text: '‚óÄÔ∏è', callback_data: `prev_month` }
{ text: '‚ñ∂Ô∏è', callback_data: `next_month` }
```

### **2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```javascript
// –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç:
userStates.set(chatId, { 
  isUpdate: boolean,
  manualInput: boolean,
  currentYear: number,
  currentMonth: number
});
```

### **3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:**
```javascript
else if (data === 'prev_month' || data === 'next_month') {
  const userState = userStates.get(chatId) || {};
  let currentYear = userState.currentYear || new Date().getFullYear();
  let currentMonth = userState.currentMonth || new Date().getMonth();
  
  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–µ—Å—è—Ü–∞/–≥–æ–¥–∞
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
}
```

## üéØ –ù–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### **–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è:**
1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –∏ –≥–æ–¥ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
3. –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–æ—Å—Ç—ã–µ callback –¥–∞–Ω–Ω—ã–µ

### **–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ ‚óÄÔ∏è (–ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü):**
1. –£–º–µ–Ω—å—à–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –Ω–∞ 1
2. –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ —á–µ—Ä–µ–∑ —è–Ω–≤–∞—Ä—å (–º–µ—Å—è—Ü < 0):
   - –ú–µ—Å—è—Ü —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –¥–µ–∫–∞–±—Ä–µ–º (11)
   - –ì–æ–¥ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ 1
3. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –ö–∞–ª–µ–Ω–¥–∞—Ä—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### **–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ ‚ñ∂Ô∏è (—Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü):**
1. –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –Ω–∞ 1
2. –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ —á–µ—Ä–µ–∑ –¥–µ–∫–∞–±—Ä—å (–º–µ—Å—è—Ü > 11):
   - –ú–µ—Å—è—Ü —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è–Ω–≤–∞—Ä–µ–º (0)
   - –ì–æ–¥ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 1
3. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –ö–∞–ª–µ–Ω–¥–∞—Ä—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

## üîÑ –õ–æ–≥–∏–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

### **–ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –º–µ—Å—è—Ü—É:**
```javascript
if (data === 'prev_month') {
  currentMonth--;
  if (currentMonth < 0) {
    currentMonth = 11;  // –î–µ–∫–∞–±—Ä—å
    currentYear--;
  }
}
```

### **–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –º–µ—Å—è—Ü—É:**
```javascript
else if (data === 'next_month') {
  currentMonth++;
  if (currentMonth > 11) {
    currentMonth = 0;   // –Ø–Ω–≤–∞—Ä—å
    currentYear++;
  }
}
```

### **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
```javascript
userStates.set(chatId, { 
  ...userState, 
  currentYear, 
  currentMonth 
});
```

## üéÆ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚ùå –ö–Ω–æ–ø–∫–∏ ‚óÄÔ∏è ‚ñ∂Ô∏è —Ä–∞–±–æ—Ç–∞–ª–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚ùå –ò–Ω–æ–≥–¥–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è
- ‚ùå –ù–∞–≤–∏–≥–∞—Ü–∏—è –±—ã–ª–∞ –∑–∞–ø—É—Ç–∞–Ω–Ω–æ–π

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚úÖ –ü–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –º–µ—Å—è—Ü–∞–º–∏
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≥—Ä–∞–Ω–∏—Ü—ã –≥–æ–¥–∞
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
```javascript
try {
  await bot.editMessageText(calendarMessage, {
    chat_id: chatId,
    message_id: message.message_id,
    reply_markup: newCalendar.reply_markup
  });
} catch (error) {
  console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è:', error);
  // Fallback: –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  await bot.sendMessage(chatId, calendarMessage, newCalendar);
}
```

### **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
```javascript
// –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞
const today = new Date();
userStates.set(chatId, { 
  ...currentState, 
  manualInput: false,
  currentYear: today.getFullYear(),
  currentMonth: today.getMonth()
});
```

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ callback –¥–∞–Ω–Ω—ã–µ
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—Ü –≥–æ–¥–∞
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
- ‚úÖ **UX**: –ü–ª–∞–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
1. **–ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –º–µ—Å—è—Ü—É** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–º–µ–Ω—å—à–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞
2. **–ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –º–µ—Å—è—Ü—É** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞
3. **–ü–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ —è–Ω–≤–∞—Ä—å** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ —Å —è–Ω–≤–∞—Ä—è –Ω–∞ –¥–µ–∫–∞–±—Ä—å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≥–æ–¥–∞
4. **–ü–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ –¥–µ–∫–∞–±—Ä—å** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ —Å –¥–µ–∫–∞–±—Ä—è –Ω–∞ —è–Ω–≤–∞—Ä—å —Å–ª–µ–¥—É—é—â–µ–≥–æ –≥–æ–¥–∞
5. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ–¥—Ä—è–¥

### **–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- –ö–∞–∂–¥—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å—Å—è
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –ø–ª–∞–≤–Ω–æ!
